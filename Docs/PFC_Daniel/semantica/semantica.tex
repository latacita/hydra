%%==================================================================%%
%% Author : Tejedo GonzÁlez, Daniel                                 %%
%%          SÁnchez Barreiro, Pablo                                 %%
%% Version: 1.0, 10/12/2012                                         %%                   %%                                                                  %%
%% Memoria del Proyecto Fin de Carrera                              %%
%% semantica, semantica                                      %%
%%==================================================================%%

Implementar la semántica del lenguaje es el último paso (sin contar las pruebas) para dar por concluido el desarrollo de nuestro editor. La semántica es la que permite que las acciones que se definen en las líneas de código escritas en el editor sean ejecutadas, luego es una parte bastante importante de todo el proceso.

En el apartado anterior indicamos que el botón de Validate era el que, además de cargar la configuración pertinente, iniciaba la validación de las restricciones definidas. Por lo tanto, el inicio de la implementación de la semántica estará contenido en el marco del manejador del botón Validate. 

Desde este manejador cargamos todas las restricciones definidas, e iniciamos el proceso de validación evaluando cada restricción una a una. Usaremos el resultado obtenido para constuir un cuadro de diálogo en el que mostraremos el resultado de validar cada una de las restricciones definidas en la configuración previamente seleccionada. 

Para realizar la validación se utiliza el método "evaluate" de la clase Operand. Este método recibe la configuración sobre la que hay que realizar la evaluación, y una característica que se usará como contexto. Al estar en la clase abstracta Operand se puede observar que es heredado a su vez por todas las posibles operaciones que pueden expresarse, de modo que cada operación pueda redefinir el método evaluate de acuerdo con la funcionalidad que ha de implementar. 

Por ejemplo, el método evaluate de la clase Plus simplemente retornará el valor numérico de la suma de su primer operando y su segundo operando. Teniendo en cuenta de que sus operandos a su vez pueden ser operaciones, la función ha de retonar en realidad el valor de la evaluación del primero de sus operandos sumado al valor de la evaluación del segundo de sus operandos.

De este modo llegará un momento en que haya que evaluar directamente objetos de clase SimpleFeature, MultipleFeature o Number, que serán las hojas del árbol resultante de parsear la restricción. Evaluar un número simplemente consiste en retornar su valor, y evaluar una característica consiste en comprobar si está seleccionada (en caso de ser simple) o mirar en cuántas ocasiones ha sido seleccionada (en caso de que sea múltiple).

Así pues, inicar la tarea de validación en el manejador requiere acceder a la operación más significativa de la restricción, ya que la clase Constraint no contiene un método evaluate. Conviene recordar que en el metamodelo habíamos indicado que una restricción solo se relaciona con una operación, y las demás las consigue mediante las relaciones de sus operandos. Gracias a eso podemos concluir que evaluar la restricción es lo mismo que evaluar su operación booleana más significativa, a la que se accede directamente desde esa relación, que nos facilita mucho la tarea en este punto.

En general, la implementación del método "evaluate" para la mayoría de las operaciones es trivial y no conlleva más de un par de líneas de código (como el caso de la suma anteriormente definido). No obstante, algunas operaciones son algo más complicadas y requieren algo más de reflexión. Hablamos de las operaciones que requieren un contexto. Hay que tener en cuenta que, tal como ha sido explicado en capítulos anteriores, las operaciones con contexto solo miran una parte muy concreta de la configuración, e implementar fue complicado ya que las evaluaciones se van encadenando y ese contexto puede modificar el comportamiento de otras operaciones.

Para solucionar este problema se añadió el parámetro "context", que simplemente es una Feature que indica a partir de qué punto en la configuración hay que tener en cuenta la evaluación. De este modo tenemos que modificar la implementación de la evaluación de SimpleFeature y MultipleFeature para tener en cuenta esto, y contar para el resultado de la evaluación únicamente las características que sean hijas de la Feature que se pasa como parámetro.

Una vez se ha concluido de implementar el método evaluate en todas las operaciones y se lanza el proceso desde el manejador del botón "Validate" se puede dar por finalizada la fase relativa a la semántica.