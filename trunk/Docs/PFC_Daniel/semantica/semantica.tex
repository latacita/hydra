%%==================================================================%%
%% Author : Tejedo González, Daniel                                 %%
%%          Sánchez Barreiro, Pablo                                 %%
%% Version: 1.0, 10/12/2012                                         %%                   
%% Version: 2.0, 11/03/2013                                         %%                   
%%                                                                  %%
%% Memoria del Proyecto Fin de Carrera                              %%
%% semantica, semantica                                             %%
%%==================================================================%%

La implementación la semántica del lenguaje es el último paso que restaba para dar por concluido el desarrollo de nuestro lenguaje. La semántica del lenguaje había sido especificada  informalmente por el profesor Pablo Sánchez de acuerdo a la estrategia descrita en la Sección~\ref{sec:meta:requisitos}.

El primer paso para poder evaluar las restricciones era cargar un fichero de configuración para el árbol de características sobre el cual definir las restricciones. Dicho de otra forma, era necesario cargar una selección de características del árbol de características original, con objeto de comprobar que dicha selección satisfacía las restricciones especificadas. 

El proceso de evaluación por tanto, analiza si cada restricción se evalúa a verdadero o falso. Si una restricción se evalúa a falso, el resultado de la evaluación será negativo. Cada restricción evaluada a falso se guarda en una lista que se utilizará al final del proceso de validación para construir un informe de incidencias que se mostrará al usuario. 

La semántica del lenguaje se ha implementado en Java, añadiendo operaciones con la lógica de evaluación a cada metaclase del metamodelo de nuestro lenguaje (ver Sección~\ref{figmetameta}. Concretamente, añadimos un método \emph{evaluate} a las diferentes metaclases involucradas en restricciones, y aprovechamos la estructura arbórea de las restricciones para evaluarlas de forma recursiva. Por ejemplo, el método evaluate de la clase \emph{Plus} simplemente retornará el valor numérico de la suma del valor de su primer operando y del valor su segundo operando. Para ello es necesario evaluar primero los operandos, los cuales vez pueden ser a su vez operaciones numéricas. Cada método \emph{evaluate} recibe como parámetro la configuración (selección de características) sobre la que hay que realizar la evaluación; y la característica que sirve como contexto para la evaluación de dicha expresión.

Evaluar un número simplemente consiste en retornar su valor. Evaluar una característica simple consiste en comprobar si está seleccionada. Si es así se evalúa a verdadero, sino se evalúa a falso. Evaluar una característica múltiple consiste en comprobar cuántas veces ha sido clonada. Si una característica, simple o múltiple, se tuviese que evaluar en un contexto, sólo se consideraría el subárbol cuya raíz es la característica que actúa de contexto.

En general, la implementación del método \emph{evaluate} para la mayoría de las operaciones es trivial y no conlleva más de un par de líneas de código (como el caso de la suma anteriormente comentado). No obstante, algunas operaciones son algo más complicadas y requieren algo más de reflexión, como, por ejemplo, las operaciones con contexto. Como se ha comentado con anterioridad, las operaciones con contexto se restringen a un subárbol del árbol de configuración. Por tanto, para buscar una característica simple o contar el número de instancias de una característica múltiple, debemos buscar sólo desde la raíz del correspondiente subárbol hacia abajo. 

Tras implementar la semántica del lenguaje, realizamos la interfaz para poder ejecutarla debidamente.


